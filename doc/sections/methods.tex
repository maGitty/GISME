\chapter{Methodology}
\label{ch:methods}

%This chapter should introduce to the theoretical background of your thesis. Any method you use to obtain the results later should be introduced and explained. 
This chapter introduces the methods that are applied in this thesis. After explaining the process of data acquisition, the used forecasting methods are explained further. Finally, the used feature selection techniques will be explained and also the methods for error measuring.\\
%In this chapter, the used forecasting methods are explained and why they were used. After that, other methodological aspects of this thesis will be outlined.\\

%Using weather data from ECMWF Copernicus Climate Change Service (C3S).\\
%Using load data from \url{https://data.open-power-system-data.org/}.\\
%First downloaded whole Datasets from 2006-2019, but as the load for germany is properly available since 2015, now reduced dataset to 2015-2019.\\
%Also checked for non-existing values, only 2 last timestamps values for the load are missing.\\

%\section{Data acquisition}
%\label{sec:dataq}
%
%In order to acquire the needed weather data, \gls{ecmwf}'s Python-API is used for automated data acquisition. The API has been extended by some functionality recently and allows to download the data with different extensions. The chosen extension is .nc, because Python's xarray library allows performant access to these files.\\
%
%The used load data has been downloaded from Open Power System Data\footnote{\url{https://data.open-power-system-data.org/time_series/}}. As the format of the downloaded data is .csv, it has also been converted to .nc to obtain performant and uniform access to all data.\\

\section{Forecasting methods}
\label{sec:forecastmet}

For time series forecasting, often used methods are \eg \gls{arma} models as mentioned in \tcite{Hyndman2018}.\\% Forecasting: Principles and Practice\footnote{\url{https://otexts.com/fpp2}}.%, but  also \gls{nn}, where it is common to reduce the number of input variables in order to speed up computation, which is desirable for the huge amount of grid-based data that grows quadratically with size. There are also some papers that use regression models other than \gls{arma} such as \gls{lr}, \gls{mlr} or \gls{svm}. \tcite{Aguiar2016} applies \gls{nn} to do intra-day solar radiation forecasting with a forecasting horizon of 1-6 hours on Gran Canaria and, as in this thesis, grid-based data from \gls{ecmwf} is used.\\

%\subsection{Linear Regression}
\subsection{ARMA}

One of the most frequently used methods for forecasting in time series forecasting is \gls{arma}, which is a combination of \acrfull{ar} and \gls{ma} terms. The formal description is given by\\

\begin{equation}
y_t = c+\sum_{i=1}^{p}\phi_iy_{t-i}+\sum_{j=1}^{q}\rho_j\epsilon_{t-j}+\epsilon_t~,
\label{eq:arma}
\end{equation}

with $c$ as a constant, $\epsilon_t$ as noise terms with respect to time $t$, $p$ as size of the \gls{ar} part, $q$ as size of the \gls{ma} part, $\phi$ and $\rho$ for the \gls{ar} and \gls{ma} coefficients respectively and $y_t$ as the expected value. \gls{arima} is similar to this, but involves an additional differentiation term to eliminate trends in the data.\\

\subsection{ARMAX}

An extension of \gls{arma} is \gls{armax}, which includes an additional term for exogenous variables. This term can be used to include relations to external factors that do not depend on the endogenous data. It is formally described as\\

\begin{equation}
y_t = c+\sum_{i=1}^{p}\phi_iy_{t-i}+\sum_{j=1}^{q}\rho_j\epsilon_{t-j}+\sum_{k=1}^{n}c_kx_k+\epsilon_t~.
\label{eq:armax}
\end{equation}

This equation almost equals \Cref{eq:arma} for the \gls{arma}. There is an additional term for $n$ included exogenous variables $x$ with $c$ as the respective coefficients.

%\subsubsection{only calendar variables as exogenous inputs}
%
%\subsubsection{additional weather variables as exogenous inputs}

\section{Feature Selection}
\label{sec:featsel}

Because the used weather data is grid-based, there are two more dimensions as usually where there is only one value per time step for a variable. This is why feature selection here is much more important to have a reasonable computation time. In the following, the used methods for feature selection will be presented.\\

\subsection{Naive approach}

The first, naive techniques that are used in order to reduce the huge amount of grid-based weather data were simple functions to reduce the two-dimensional such as the maximum or mean over the whole grid for each step respectively. An exemplary formula for a reduction using the mean can be described as\\

\begin{equation}
x_t = \frac{1}{l \times m} \sum_{i=1}^{l}\sum_{j=1}^{m}x_{ij}~.
\end{equation}

\subsection{Using population data}

This method involves population data from Eurostat\footnote{\url{https://ec.europa.eu/eurostat/data/database}}. The used data contains the population of NUTS 3 level regions. The regions are then sorted by population and the regions with the highest population are used to filter the respective grid points that are then used as exogenous variables.\\

%\subsection{Principal Component Analysis}

\section{Forecast Evaluation}
\label{sec:fceval}

In order to estimate whether the used model performs well, it is important to apply suitable metrics to evaluate the results. In the following, the used metrics are introduced.\\

\subsection{Root Mean Squared Error}

The \gls{rmse} is an often used, scale-dependent accuracy measure that is used to calculate the root of the squared mean of the differences between the forecast and the actual values. It is described by\\

\begin{equation}
RMSE = \sqrt{\frac{1}{k} \sum_{i=1}^{k} (y_i-\hat{y}_i)^2}~,
\label{eq:rmse}
\end{equation}

where $k$ is the size, $y$ the actual values and $\hat{y}$ the predicted values.\\

\subsection{Mean Absolute Percentage Error}

The \gls{mape} is a relative measure of prediction accuracy. It is multiplied by 100 which makes it a percentage error. The equation for the \gls{mape} is\\

\begin{equation}
MAPE = \frac{1}{k}\times 100 \sum_{i=1}^{k} \left|\frac{y_i-\hat{y}_i}{y_i}\right|~,
\label{eq:mape}
\end{equation}

with $k$ for the size, $y$ for the actual values and $\hat{y}$ for predicted values.\\

%Maybe use Random Forests for variable selection as in Nicoles paper? \Parencite{Ludwig2015}\\

%This is an example for a simple equation without equation numbering.
%$$
%\sum\limits_{i=1}^{n}{x_i}
%$$

%You can also use equation numbering if you need to refer to an equation later \eg \Cref{eq:ex1}.


%\begin{equation}
%a^2 + b^2 = c^2
%\label{eq:ex1}
%\end{equation}
%
%Additionally, simple equations can be put inline with the text, for example, $x \in X$. Remember to set all variables in math font \ie all $x$, $i$ and so on.
%
%\section{Method 2}
%
%\dots

